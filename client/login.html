<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sokpheak POS | System Login</title>
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://unpkg.com/@phosphor-icons/web"></script>
<link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;700;900&family=Noto+Serif+Khmer:wght@400;700&display=swap" rel="stylesheet">
<style>
    body { font-family: 'Outfit', 'Noto Serif Khmer', sans-serif; }
    .glass-panel { background: rgba(255, 255, 255, 0.85); backdrop-filter: blur(16px); -webkit-backdrop-filter: blur(16px); }
</style>
</head>
<body class="bg-slate-900 min-h-screen flex items-center justify-center relative overflow-hidden">

    <div class="absolute inset-0 bg-[url('https://images.unsplash.com/photo-1557683316-973673baf926?q=80&w=2000&auto=format&fit=crop')] bg-cover bg-center opacity-30"></div>
    <div class="absolute inset-0 bg-gradient-to-br from-blue-900/80 via-slate-900/95 to-slate-900"></div>
    <div class="absolute top-1/4 left-1/4 w-96 h-96 bg-blue-500/30 rounded-full blur-3xl animate-pulse"></div>
    <div class="absolute bottom-1/4 right-1/4 w-96 h-96 bg-teal-500/20 rounded-full blur-3xl animate-pulse" style="animation-delay: 2s;"></div>

    <div id="login-app" class="relative z-10 w-full max-w-md p-6">
        <div class="glass-panel p-10 rounded-[2.5rem] shadow-2xl border border-white/20">
            <div class="text-center mb-10">
                <div class="w-16 h-16 bg-gradient-to-tr from-blue-600 to-teal-400 rounded-2xl flex items-center justify-center text-white text-3xl font-black shadow-lg mx-auto mb-4 transform rotate-3">S</div>
                <h2 class="text-3xl font-black text-slate-900 tracking-tight">Welcome Back</h2>
                <p class="text-slate-500 text-sm mt-2">Sign in to Sokpheak POS System</p>
            </div>

            <form @submit.prevent="handleLogin" class="space-y-5">
                <div class="space-y-1.5">
                    <label class="text-xs font-bold uppercase text-slate-500 tracking-wider">Username / Email</label>
                    <div class="relative">
                        <i class="ph-fill ph-user absolute left-4 top-1/2 -translate-y-1/2 text-slate-400 text-lg"></i>
                        <input v-model="form.username" type="text" required
                            class="w-full bg-white/50 border border-slate-200 rounded-2xl py-4 pl-12 pr-4 focus:ring-4 focus:ring-blue-500/10 focus:border-blue-500 focus:bg-white outline-none transition-all font-medium text-slate-800" 
                            placeholder="Enter username">
                    </div>
                </div>

                <div class="space-y-1.5">
                    <label class="text-xs font-bold uppercase text-slate-500 tracking-wider">Password</label>
                    <div class="relative">
                        <i class="ph-fill ph-lock-key absolute left-4 top-1/2 -translate-y-1/2 text-slate-400 text-lg"></i>
                        <input v-model="form.password" type="password" required
                            class="w-full bg-white/50 border border-slate-200 rounded-2xl py-4 pl-12 pr-4 focus:ring-4 focus:ring-blue-500/10 focus:border-blue-500 focus:bg-white outline-none transition-all font-medium text-slate-800" 
                            placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢">
                    </div>
                </div>

                <div v-if="errorMessage" class="p-3 bg-red-50 border border-red-100 rounded-xl flex items-center gap-2 text-red-600 text-sm font-medium">
                    <i class="ph-fill ph-warning-circle text-lg"></i> {{ errorMessage }}
                </div>

                <button type="submit" :disabled="loading" 
                    class="w-full bg-slate-900 text-white py-4 rounded-2xl font-bold hover:bg-blue-600 hover:shadow-lg hover:shadow-blue-600/25 transition-all duration-300 flex items-center justify-center gap-2 mt-4 disabled:opacity-70">
                    <span v-if="loading" class="w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin"></span>
                    <span v-else>Login to System</span>
                </button>
            </form>
        </div>
    </div>

<script type="module">
    import { createApp, ref } from 'https://unpkg.com/vue@3/dist/vue.esm-browser.js';
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js';
    import { getFirestore, collection, query, where, getDocs } from 'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';

    // ğŸ”´ áŸáŸ†áá¶á“áŸ‹áŸ– áŸá¼á˜á™á€ Firebase Config ášá”áŸáŸ‹á¢áŸ’á“á€á˜á€áŠá¶á€áŸ‹á‘á¸á“áŸáŸ‡
    const firebaseConfig = {
        apiKey: "YOUR_API_KEY",
        authDomain: "YOUR_PROJECT_ID.firebaseapp.com",
        projectId: "YOUR_PROJECT_ID",
        storageBucket: "YOUR_PROJECT_ID.appspot.com",
        messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
        appId: "YOUR_APP_ID"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    createApp({
        setup() {
            const form = ref({ username: '', password: '' });
            const loading = ref(false);
            const errorMessage = ref('');

            const handleLogin = async () => {
    loading.value = true;
    try {
        const userRef = collection(db.value, "users");
        const q = query(userRef, where("username", "==", loginForm.username), where("password", "==", loginForm.password));
        const querySnapshot = await getDocs(q);

        if (!querySnapshot.empty) {
            const userData = querySnapshot.docs[0].data();
            isLoggedIn.value = true;
            userRole.value = userData.role || 'seller'; 
            loggedInUserFullName.value = userData.fullName || userData.username;
            userPhotoUrl.value = userData.photoUrl || '';
            adminName.value = userData.adminName || 'Pov Daro'; 
            
            // âœ… á”á“áŸ’ááŸ‚á˜á”á“áŸ’á‘á¶ááŸ‹á“áŸáŸ‡ áŠá¾á˜áŸ’á”á¸ Save á‘á·á“áŸ’á“á“áŸá™á”á‰áŸ’á‡á¼á“á‘áŸ…á‘áŸ†á–áŸáš Report
            localStorage.setItem('dpos_session', JSON.stringify({
                fullName: loggedInUserFullName.value,
                role: userRole.value,
                photoUrl: userPhotoUrl.value
            }));
            
            notify("á‡áŸ„á‚á‡áŸá™", `áŸá¼á˜áŸáŸ’áœá¶á‚á˜á“áŸ ${loggedInUserFullName.value.toUpperCase()}`);
            fetchProducts();
        } else {
            notify("á”ášá¶á‡áŸá™", "á‚áá“á¸á˜á·á“ááŸ’ášá¹á˜ááŸ’ášá¼áœ!", "error");
        }
    } catch (error) { console.error(error); } 
    finally { loading.value = false; }
};

            return { form, loading, errorMessage, handleLogin };
        }
    }).mount('#login-app');
</script>
</body>
</html>